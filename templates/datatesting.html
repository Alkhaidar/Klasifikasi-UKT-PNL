{% extends 'layout.html' %}

{% block content %}
<div class="pagetitle">
  <h1>Data Testing</h1>
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="">Home</a></li>
      <li class="breadcrumb-item active">Data Testing</li>
    </ol>
  </nav>
</div><!-- End Page Title -->

<!-- Button untuk menampilkan modal form tambah -->
<button id="tambahButton" type="button" class="btn btn-primary mb-2" data-bs-toggle="modal"
  data-bs-target="#tambahModal">
  <span class="badge bg-primary"><i class="bi bi-plus"></i>Upload Excel</span>
</button>

<!-- Modal form tambah -->
<div class="modal fade" id="tambahModal" tabindex="-1" aria-labelledby="tambahModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-primary font-weight-bold" id="tambahModalLabel">Tambah Data</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Isi formulir tambah di sini -->
        <form method="POST" action="/datatesting" enctype="multipart/form-data">
          <div class="row mb-3">
            <div class="col-sm-12">
              <div class="input-group">
                <input type="hidden" name="excel" value="True">
                <input type="file" name="file" class="form-control" required>
              </div>
            </div>
            <div class="col-sm-12 text-secondary">
              <i class="bi bi-info-circle-fill text-info me-1"></i> File harus memiliki ekstensi .xlsx
            </div>
          </div>
          <div class="row mb-2 justify-content-end">
            <div class="col-sm-auto me-1">
              <button type="reset" class="btn btn-secondary">
                <i class="bi bi-arrow-counterclockwise me-1"></i> Reset
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-cloud-upload me-1"></i> Upload
              </button>
            </div>
          </div>
      </div>
      </form>
    </div>
  </div>
</div>
</div>

<!-- Button untuk menampilkan modal form tambah -->
<button id="tambahButtondata" type="button" class="btn btn-primary mb-2" data-bs-toggle="modal"
  data-bs-target="#tambahmodalform">
  <span class="badge bg-primary"><i class="bi bi-plus"></i>Input Data</span>
</button>

<!-- Modal Form Tambah -->
<div class="modal fade" id="tambahmodalform" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Tambah Data</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Form -->
        <form method="POST" action="/datatesting" enctype="multipart/form-data">
          <input type="hidden" name="excel" value="False">
          <div class="mb-3">
            <label for="nama" class="form-label">Nama</label>
          <input required type="text" class="form-control" id="nama" placeholder="Masukkan nama" name="nama" oninput="this.value = this.value.replace(/[^a-zA-Z\s]/g, '')">
          </div>
          <div class="mb-3">
            <label for="jurusan" class="form-label">Jurusan</label>
            <select class="form-select" id="jurusan" name="jurusan">
              <option value="Teknik Sipil">Teknik Sipil</option>
              <option value="Teknik Mesin">Teknik Mesin</option>
              <option value="Teknik Kimia">Teknik Kimia</option>
              <option value="Teknik Elektro">Teknik Elektro</option>
              <option value="Tata Niaga">Tata Niaga</option>
              <option value="Teknologi Informasi Dan Komputer">Teknologi Informasi Dan Komputer</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="prodi" class="form-label">Prodi</label>
            <select class="form-select" id="prodi" name="prodi">
              <option value="Administrasi Bisnis">Administrasi Bisnis</option>
              <option value="Akuntansi">Akuntansi</option>
              <option value="Perbankan dan Keuangan">Perbankan dan Keuangan</option>
              <option value="Teknologi Elektronika">Teknologi Elektronika</option>
              <option value="Teknologi Industri">Teknologi Industri</option>
              <option value="Teknologi Kimia">Teknologi Kimia</option>
              <option value="Teknologi Kontruksi Bangunan Air">Teknologi Kontruksi Bangunan Air</option>
              <option value="Teknologi Kontruksi Bangunan Gedung">Teknologi Kontruksi Bangunan Gedung</option>
              <option value="Teknologi Kontruksi Jalan dan Jembatan">Teknologi Kontruksi Jalan dan Jembatan</option>
              <option value="Teknologi Listrik">Teknologi Listrik</option>
              <option value="Teknologi Mesin">Teknologi Mesin</option>
              <option value="Teknologi Pengelohan Minyak dan Gas">Teknologi Pengelohan Minyak dan Gas</option>
              <option value="Teknologi Telekomunikasi">Teknologi Telekomunikasi</option>
              <option value="Akuntansi Lembaga Keuangan Syariah">Akuntansi Lembaga Keuangan Syariah</option>
              <option value="Teknik Informatika">Teknik Informatika</option>
              <option value="Teknologi Rekayasa Instrumentasi dan Kontrol">Teknologi Rekayasa Instrumentasi dan Kontrol</option>
              <option value="Teknologi Rekayasa Jaringan Telekomunikasi">Teknologi Rekayasa Jaringan Telekomunikasi</option>
              <option value="Teknologi Rekayasa Kimia Industri">Teknologi Rekayasa Kimia Industri</option>
              <option value="Teknologi Rekayasa Komputer Jaringan">Teknologi Rekayasa Komputer Jaringan</option>
              <option value="Teknologi Rekayasa Konstruksi Jalan dan Jembatan">Teknologi Rekayasa Konstruksi Jalan dan Jembatan</option>
              <option value="Teknologi Rekayasa Manufaktur">Teknologi Rekayasa Manufaktur</option>
              <option value="Teknologi Rekayasa Pembangkit Energi">Teknologi Rekayasa Pembangkit Energi</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="pekerjaan_ayah" class="form-label">Pekejaan Ayah</label>
            <select class="form-select" id="pekerjaan_ayah" name="pekerjaan_ayah">
              <option value="0">TIDAK BEKERJA</option>
              <option value="1">Petani</option>
              <option value="2">Nelayan</option>
              <option value="3">PNS</option>
              <option value="4">Wirausaha</option>
              <option value="5">Peg. Swasta</option>
              <option value="6">TNI / POLRI</option>
              <option value="7">Lainnya</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="penghasilan_ayah" class="form-label">Penghasilan Ayah</label>
            <select class="form-select" id="penghasilan_ayah" name="penghasilan_ayah">
              <option value="0">Tidak Berpenghasilan</option>
              <option value="1"> < Rp. 250.000</option>
              <option value="2">Rp. 250.001 - Rp. 500.000</option>
              <option value="3">Rp. 500.001 - Rp. 750.000</option>
              <option value="4">Rp. 750.001 - Rp. 1.000.000</option>
              <option value="5">Rp. 1.000.001 - Rp. 1.250.000</option>
              <option value="6">Rp. 1.250.001 - Rp. 1.500.000</option>
              <option value="7">Rp. 1.500.001 - Rp. 1.750.000</option>
              <option value="8">Rp. 1.750.001 - Rp. 2.000.000</option>
              <option value="9">Rp. 2.000.001 - Rp. 2.250.000</option>
              <option value="10">Rp. 2.250.001 - Rp. 2.500.000</option>
              <option value="11">Rp. 2.500.001 - Rp. 2.750.000</option>
              <option value="12">Rp. 2.750.001 - Rp. 3.000.000</option>
              <option value="13">Rp. 3.000.001 - Rp. 3.250.000</option>
              <option value="14">Rp. 3.250.001 - Rp. 3.500.000</option>
              <option value="15">Rp. 3.500.001 - Rp. 3.750.000</option>
              <option value="16">Rp. 3.750.001 - Rp. 4.000.000</option>
              <option value="17">Rp. 4.000.001 - Rp. 4.250.000</option>
              <option value="18">Rp. 4.250.001 - Rp. 4.500.000</option>
              <option value="19">Rp. 4.500.001 - Rp. 4.750.000</option>
              <option value="20">Rp. 4.750.001 - Rp. 5.000.000</option>
              <option value="21">Rp. 5.000.001 - Rp. 5.250.000</option>
              <option value="22">Rp. 5.250.001 - Rp. 5.500.000</option>
              <option value="23">Rp. 5.500.001 - Rp. 5.750.000</option>
              
            </select>
          </div>
          <div class="mb-3">
            <label for="status_ayah" class="form-label">Status Ayah</label>
            <select class="form-select" id="status_ayah" name="status_ayah">
              <option value="0">Wafat</option>
              <option value="1">Hidup</option>
              <option value="2">Becerai</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="pekerjaan_ibu" class="form-label">Pekerjaan Ibu</label>
            <select class="form-select" id="pekerjaan_ibu" name="pekerjaan_ibu">
              <option value="0">Tidak Bekerja</option>
              <option value="1">Petani</option>
              <option value="2">Wirausaha</option>
              <option value="3">Pegawai Swasta</option>
              <option value="4">PNS</option>
              <option value="5">Lainnya</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="penghasilan_ibu" class="form-label">Penghasilan Ibu</label>
            <select class="form-select" id="penghasilan_ibu" name="penghasilan_ibu">
              <option value="0">Tidak Berpenghasilan</option>
              <option value="1"> < Rp. 250.000</option>
              <option value="2">Rp. 250.001 - Rp. 500.000</option>
              <option value="3">Rp. 500.001 - Rp. 750.000</option>
              <option value="4">Rp. 750.001 - Rp. 1.000.000</option>
              <option value="5">Rp. 1.000.001 - Rp. 1.250.000</option>
              <option value="6">Rp. 1.250.001 - Rp. 1.500.000</option>
              <option value="7">Rp. 1.500.001 - Rp. 1.750.000</option>
              <option value="8">Rp. 1.750.001 - Rp. 2.000.000</option>
              <option value="9">Rp. 2.000.001 - Rp. 2.250.000</option>
              <option value="10">Rp. 2.250.001 - Rp. 2.500.000</option>
              <option value="11">Rp. 2.500.001 - Rp. 2.750.000</option>
              <option value="12">Rp. 2.750.001 - Rp. 3.000.000</option>
              <option value="13">Rp. 3.000.001 - Rp. 3.250.000</option>
              <option value="14">Rp. 3.250.001 - Rp. 3.500.000</option>
              <option value="15">Rp. 3.500.001 - Rp. 3.750.000</option>
              <option value="16">Rp. 3.750.001 - Rp. 4.000.000</option>
              <option value="17">Rp. 4.000.001 - Rp. 4.250.000</option>
              <option value="18">Rp. 4.250.001 - Rp. 4.500.000</option>
              <option value="19">Rp. 4.500.001 - Rp. 4.750.000</option>
              <option value="20">Rp. 4.750.001 - Rp. 5.000.000</option>
              <option value="21">Rp. 5.000.001 - Rp. 5.250.000</option>
              <option value="22">Rp. 5.250.001 - Rp. 5.500.000</option>              
            </select>
          </div>
          <div class="mb-3">
            <label for="status_ibu" class="form-label">Status Ibu</label>
            <select class="form-select" id="status_ibu" name="status_ibu">
              <option value="0">Wafat</option>
              <option value="1">Hidup</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="jumlah_tanggungan" class="form-label">Jumlah Tanggungan</label>
            <select class="form-select" id="jumlah_tanggungan" name="jumlah_tanggungan">
              <option value="1">1 Orang</option>
              <option value="2">2 Orang</option>
              <option value="3">3 Orang</option>
              <option value="4">4 Orang</option>
              <option value="5">5 Orang</option>
              <option value="6">6 Orang</option>
              <option value="7">7 Orang</option>
              <option value="8">8 Orang</option>
              <option value="9">9 Orang</option>
              <option value="10">10 Orang</option>
            </select>
          </div>
          <div class="mb-3">  
            <label for="kepemilikan_rumah" class="form-label">Kepemilikan Rumah</label>
            <select class="form-select" id="kepemilikan_rumah" name="kepemilikan_rumah">
              <option value="0">Tidak Memiliki</option>
              <option value="1">Menumpang Tanpa Izin</option>
              <option value="2">Menumpang</option>
              <option value="3">Sewa Bulanan</option>
              <option value="4">Sewa Tahunan</option>
              <option value="5">Sendiri</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="sumber_air" class="form-label">Sumber Air</label>
            <select class="form-select" id="sumber_air" name="sumber_air">
              <option value="0">Sumur</option>
              <option value="1">Sungai/Mata Air</option>
              <option value="2">PDAM</option>
              <option value="3">Kemasan</option>                        
            </select>
          </div>
          <div class="mb-3">
            <label for="kendaraan_roda_4" class="form-label">Kendaraan Roda 4</label>
            <select class="form-select" id="kendaraan_roda_4" name="kendaraan_roda_4">
              <option value="0">0</option>
              <option value="1">1</option>          
              <option value="2">2</option> 
              <option value="3">3</option>          
              <option value="4">4</option> 
              <option value="5">5</option> 
              <option value="6">6</option> 
              <option value="7">7</option> 
              <option value="8">8</option> 
              <option value="9">9</option> 
              <option value="10">10</option> 
            </select>
          </div>
          <div class="mb-3">
            <label for="kendaraan_roda_2" class="form-label">Kendaraan Roda 2</label>
            <select class="form-select" id="kendaraan_roda_2" name="kendaraan_roda_2">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option> 
              <option value="5">5</option> 
              <option value="6">6</option> 
              <option value="7">7</option> 
              <option value="8">8</option> 
              <option value="9">9</option> 
              <option value="10">10</option> 
            </select>
          </div>
          <div class="mb-3">
            <label for="biaya_listrik" class="form-label">Biaya Listrik</label>
            <select class="form-select" id="biaya_listrik" name="biaya_listrik">
              <option value="1">Rp 50,000</option>
              <option value="2">Rp 100,000</option>
              <option value="3">Rp 150,000</option>
              <option value="4">Rp 200,000</option>
              <option value="5">Rp 250,000</option>
              <option value="6">Rp 300,000</option>              
            </select>
          </div>
          <div class="mb-3">
            <label for="watt_listrik" class="form-label">Ampere Listrik</label>
            <select class="form-select" id="watt_listrik" name="watt_listrik">
              <option value="1">1 Ampere</option>
              <option value="2">2 Ampere</option>
              <option value="3">3 Ampere</option>
              <option value="4">4 Ampere</option>
              <option value="5">5 Ampere</option>
              <option value="6">6 Ampere</option>
              <option value="7">7 Ampere</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="kondisi_rumah" class="form-label">Kondisi Rumah</label>
            <select class="form-select" id="kondisi_rumah" name="kondisi_rumah">
              <option value="0">Buruk</option>
              <option value="1">Sedang</option>
              <option value="2">Baik</option>
            </select>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
            <button type="submit" class="btn btn-primary">Klasifikasi</button>
          </div>
        </form>
        <!-- End Form -->
      </div>
      
    </div>
  </div>
</div>

<section class="section">
  {% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for message in messages %}
      {% if message.startswith('ERROR:') %}
      <div class="alert alert-danger alert-dismissible fade show mb-2" role="alert">
      {% else %}
      <div class="alert alert-success alert-dismissible fade show mb-2" role="alert">
      {% endif %}
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}
  <div class="col-lg-12">
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Data Testing</h5>
        <!-- Table with stripped rows -->

        <table id="myTable" class="table responsive nowrap table-bordered table-striped align-middle"
          style="width:100%">
          <thead>
            <tr>
              <th>No</th>
              <th>Nama Mahasiswa</th>
              <th>Pekerjaan Ayah</th>
              <th>Penghasilan Ayah</th>
              <th>Status Ayah</th>
              <th>Pekejaan Ibu</th>
              <th>Penghasilan Ibu</th>
              <th>Status Ibu</th>
              <th>Jumlah Tanggungan</th>
              <th>Kepemilikan Rumah</th>
              <th>Sumber Air</th>
              <th>Jumlah Kendaraan Roda Empat </th>
              <th>Jumlah Kendaraan Roda Dua</th>
              <th>Biaya Listrik Bulanan</th>
              <th>Watt Listrik</th>
              <th>Kondisi Rumah</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for row in tbl_datatesting %}
            <tr>
              <td>{{loop.index}}</td>
              <td>{{row.1}}</td>
              <td>{{ convertPA(row.4) }}</td>
              <td>{{ convertPA1(row.5) }}</td>
              <td>{{ convertSA(row.6) }}</td>
              <td>{{ convertPI(row.7) }}</td>
              <td>{{ convertPI1(row.8) }}</td>
              <td>{{ convertSI(row.9) }}</td>
              <td>{{row.10}} Orang</td>
              <td>{{ convertKR(row.11) }}</td>
              <td>{{ convertSA1(row.12) }}</td>
              <td>{{row.13}}</td>
              <td>{{row.14}}</td>
              <td>{{ convertBLB(row.15) }}</td>
              <td>{{row.16}} Ampere</td>
              <td>{{ convertKR1(row.17) }}</td>
              <td>
                <button class="btn btn-danger" data-bs-toggle="modal"
                data-bs-target="#modalHapus{{ loop.index }}">
                 <i class="bi bi-trash"></i>
                </button>
              </td>
            </tr>
             <!-- modal hapus -->
             <div class="modal fade" id="modalHapus{{ loop.index }}" tabindex="-1"
             aria-labelledby="exampleModalLabel" aria-hidden="true">
             <div class="modal-dialog">
                 <div class="modal-content">
                     <div class="modal-header">
                         <h5 class="modal-title" id="exampleModalLabel">Delete Data Testing</h5>
                         <button type="button" class="btn-close" data-bs-dismiss="modal"
                             aria-label="Close"></button>
                     </div>
                     <form action="/deletedatatesting/{{ row.0 }}" method="POST">
                         <div class="modal-body">
                             <div class="row">
                                 <input type="hidden" name="_method" value="DELETE">
                                 <p class="fs-6">Apakah Anda Yakin Menghapus Hasil Klasifikasi <b>{{row.1}}</b>?</p>
                             </div>
                         </div>
                         <div class="modal-footer">
                             <button type="button" class="btn btn-secondary"
                                 data-bs-dismiss="modal">Cancel</button>
                             <button type="submit" class="btn btn-outline-danger">Delete</button>
                         </div>
                     </form>
                 </div>
             </div>
         </div>
         <!-- end modal hapus -->
            {% endfor %}
          </tbody>
        </table>
        <!-- End Table with stripped rows -->
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    var jurusanSelect = document.getElementById("jurusan");
    var prodiSelect = document.getElementById("prodi");
    
    // Objek yang berisi jurusan dan prodi
    var jurusanProdi = {
      "Teknik Sipil": [
        "Teknologi Kontruksi Bangunan Air",
        "Teknologi Kontruksi Jalan dan Jembatan",
        "Teknologi Kontruksi Bangunan Gedung"
      ],
      "Teknik Kimia": [
        "Teknologi Kontruksi Jalan dan Jembatan",
        "Teknologi Pengelohan Minyak dan Gas",
        "Teknologi Rekayasa Kimia Industri",
        "Teknologi Kimia"
      ],
      "Teknik Mesin": [
        "Teknologi Mesin",
        "Teknologi Industri",
        "Teknologi Rekayasa Manufaktur"
      ],
      "Teknik Elektro": [
        "Teknologi Listrik",
        "Teknologi Telekomunikasi",
        "Teknologi Rekayasa Instrumentasi dan Kontrol",
        "Teknologi Rekayasa Jaringan Telekomunikasi",
        "Teknologi Rekayasa Pembangkit Energi"
      ],
      "Tata Niaga": [
        "Administrasi Bisnis",
        "Akuntansi",
        "Perbankan dan Keuangan",
        "Akuntansi Lembaga Keuangan Syariah"
      ],
      "Teknologi Informasi Dan Komputer": [
        "Teknik Informatika",
        "Teknologi Rekayasa Komputer Jaringan"
      ]
    };
  
    // Fungsi untuk mengisi dropdown prodi berdasarkan jurusan yang dipilih
    function populateProdi() {
      var selectedJurusan = jurusanSelect.value;
      prodiSelect.innerHTML = ""; // Menghapus opsi prodi sebelumnya
  
      // Jika jurusan dipilih, tambahkan opsi prodi sesuai dengan jurusan tersebut
      if (selectedJurusan !== "") {
        var prodiOptions = jurusanProdi[selectedJurusan];
        for (var i = 0; i < prodiOptions.length; i++) {
          var option = document.createElement("option");
          option.text = prodiOptions[i];
          option.value = prodiOptions[i];
          prodiSelect.appendChild(option);
        }
      }
    }
  
    // Panggil fungsi populateProdi() ketika nilai dropdown jurusan berubah
    jurusanSelect.addEventListener("change", populateProdi);
  
  });


  // Menangani klik tombol tambah
  document.getElementById('tambahButton').addEventListener('click', function () {
    // Kosongkan form tambah sebelum menampilkannya
    document.getElementById('formTambah').reset();
  });
</script>

{% endblock %}